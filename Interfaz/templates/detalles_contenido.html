<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalles del Contenido</title>
    <link rel="stylesheet" href="/static/detalles_contenido.css">
</head>
<body>
    <!-- Encabezado -->
    <div class="header">
        <h1>Catálogo de Películas</h1>
        <a href="perfil.html" class="perfil-button">Perfil</a>
    </div>

    <!-- Contenido -->
    <div class="container">
        <!-- Tarjeta de una película -->
        <div class="movie-card">
            <div class="movie-poster" style="background-image: url('https://via.placeholder.com/200x300');"></div>
            <div class="movie-details">
                <div>
                    <div class="movie-title">{{ detalles_contenido["titulo"] }}</div>

                    <!-- Condicional: Si es una Película -->
                    {% if detalles_contenido["tipoContenido"] == "Pelicula" %}
                        <div class="movie-info">
                            <span><strong>Género: </strong>{{ detalles_contenido["idGenero"] }}</span> | 
                            <span><strong>Duración: </strong> {{ detalles_contenido["duracion"] }} minutos</span> | 
                            <span><strong>Director: </strong>{{ detalles_contenido["idDirector"] }}</span>
                        </div>
                    <!-- Condicional: Si es una Serie -->
                    {% elif detalles_contenido["tipoContenido"] == "Serie" %}
                        <span><strong>Género: </strong>{{ detalles_contenido["idGenero"] }}</span>
                    {% endif %}

                    <div class="movie-actions">
                        <!-- Botón Me gusta -->
                        <button id="like-button" class="action-button" 
                                onclick="toggleLike('{{ detalles_contenido.id }}')">
                            Me gusta
                        </button>
                    
                        <!-- Botón Lista Personalizada -->
                        <button id="custom-list-button" class="action-button" 
                                onclick="toggleCustomList('{{ detalles_contenido.id }}')">
                            Añadir a mi lista
                        </button>
                    
                        <!-- Sección de valoración -->
                        <div class="rating-section">
                            <label for="rating-input">Valorar:</label>
                            <select id="rating-input" class="rating-input">
                                <option value="">Selecciona</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                            <button class="action-button" onclick="submitRating('{{ detalles_contenido.id }}')">
                                Enviar
                            </button>
                        </div>
                    </div>
                    

                    <div class="movie-description">
                        {{ detalles_contenido["descripcion"] }}
                    </div>
                </div>
                <div>
                    <span><strong>Fecha de lanzamiento:</strong> {{ detalles_contenido["fechaLanzamiento"] }}</span><br>
                    <span><strong>Valoración promedio:</strong> <span class="rating">{{ detalles_contenido["valoracionPromedio"] }}</span></span>
                </div>

                <!-- Sección de Reparto -->
                <div class="reparto">
                    <strong>Reparto:</strong>
                    <ul>
                        {% for actor in reparto %}
                            <li class="actor-name">{{ actor.nombre }}</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Sección de Doblajes -->
                <div class="doblajes">
                    <strong>Doblajes Disponibles:</strong>
                    <ul>
                        {% for doblaje in doblajes %}
                            <li class="doblaje-item">{{ doblaje.idioma }}</li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Sección de Subtítulos -->
                <div class="subtitulos">
                    <strong>Subtítulos Disponibles:</strong>
                    <ul>
                        {% for subtitulo in subtitulos %}
                            <li class="subtitulo-item">{{ subtitulo.idioma }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <!-- Detalles específicos de la serie -->
        {% if detalles_contenido["tipoContenido"] == "Serie" %}
            <div class="serie-info">
                <h3>Temporadas</h3>
                <ul>
                    {% for temporada in temporadas %}
                        <li>
                            <strong>Temporada {{ temporada.numeroTemporada }}</strong>
                            <ul class="episodios-lista">
                                <!-- Mostrar los episodios de esta temporada -->
                                {% for episodio in episodios if episodio.idTemporada == temporada.idTemporada %}
                                    <li class="episodio-item">
                                        <strong>E{{ episodio.numeroEpisodio }}</strong>:
                                        ({{ episodio.duracion }} min)
                                    </li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>

    <!-- Pie de página -->
    <footer>
        <p>Derechos reservados &copy; 2024</p>
    </footer>

    <script>
        const userId = "{{ idUsuario }}"; // ID del usuario actual
    
        // Función para dar/quitar "Me gusta"
        async function toggleLike(contentId) {
            const likeButton = document.getElementById("like-button");
            const isLiked = likeButton.classList.contains("liked");
    
            try {
                if (isLiked) {
                    // Eliminar "Me gusta"
                    await fetch(`/usuarios/${userId}/me-gusta/${contentId}`, { method: "DELETE" });
                    likeButton.classList.remove("liked");
                    likeButton.textContent = "Me gusta";
                } else {
                    // Dar "Me gusta"
                    await fetch(`/usuarios/${userId}/me-gusta/${contentId}`, { method: "POST" });
                    likeButton.classList.add("liked");
                    likeButton.textContent = "Quitar Me gusta";
                }
            } catch (error) {
                console.error("Error al gestionar 'Me gusta':", error);
            }
        }
    
        // Función para añadir/quitar de la lista personalizada
        async function toggleCustomList(contentId) {
            const customListButton = document.getElementById("custom-list-button");
            const isInList = customListButton.classList.contains("in-list");
    
            try {
                if (isInList) {
                    // Eliminar de lista personalizada
                    await fetch(`/usuarios/${userId}/listaPersonalizada/${contentId}`, { method: "DELETE" });
                    customListButton.classList.remove("in-list");
                    customListButton.textContent = "Añadir a mi lista";
                } else {
                    // Añadir a lista personalizada
                    await fetch(`/usuarios/${userId}/listaPersonalizada/${contentId}`, { method: "POST" });
                    customListButton.classList.add("in-list");
                    customListButton.textContent = "Quitar de mi lista";
                }
            } catch (error) {
                console.error("Error al gestionar la lista personalizada:", error);
            }
        }
    
        // Función para enviar valoración
        async function submitRating(contentId) {
            const ratingInput = document.getElementById("rating-input");
            const rating = ratingInput.value;
    
            if (!rating) {
                alert("Por favor selecciona una valoración.");
                return;
            }
    
            try {
                await fetch(`/usuarios/${userId}/valoraciones/${contentId}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ valoracion: parseInt(rating) }),
                });
                alert("¡Gracias por tu valoración!");
            } catch (error) {
                console.error("Error al enviar valoración:", error);
            }
        }
    </script>
    

</body>
</html>
