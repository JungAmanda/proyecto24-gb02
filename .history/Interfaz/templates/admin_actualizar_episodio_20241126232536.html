<!DOCTYPE html>
<html lang="en">

<head>
    <title>Actualizar episodio</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/header_footer.css">
    <script>
        async function loadTemporadas(serieId) {
            const temporadasSelect = document.getElementById("temporadas");
            temporadasSelect.innerHTML = '<option value="">Cargando...</option>';

            try {
                const response = await fetch(`/contenidos/${serieId}/temporadas`);
                const temporadas = await response.json();

                temporadasSelect.innerHTML = '<option value="">Seleccione una temporada</option>';
                temporadas.forEach(temporada => {
                    const option = document.createElement("option");
                    option.value = temporada.idTemporada;
                    option.textContent = `Temporada ${temporada.numeroTemporada}`;
                    temporadasSelect.appendChild(option);
                });
            } catch (error) {
                temporadasSelect.innerHTML = '<option value="">Error al cargar temporadas</option>';
            }
        }
    </script>    
</head>

<header>
    <div class="navbar">
        <div class="logo">
            <a href=#>Streamflix: Actualizar episodio</a>
        </div>
        <nav>
            <ul>
                <li><a href="/admin_menu" class="return-button">Volver al menú</a></li>
            </ul>
        </nav>
    </div>
</header>

<body>
    {% if error_message %}
    <p style="color:red;">{{ error_message }}</p>
    {% endif %}
    <div class="container">
        <form action="/administrador/update_episodio/{{episodio_id}}" method="post">
            <label for="id_serie">Serie:</label>
            <select id="id_serie" name="id_serie" onchange="loadTemporadas(this.value)" required>
                {% for serie in series %}
                    <option value="{{ serie.id }}" {% if serie.id == idSerie %}selected{% endif %}>
                        {{ serie.titulo }}
                    </option>
                {% endfor %}
            </select><br>
            <label for="temporadas">Temporada:</label>
            <select id="temporadas" name="id_temporada" required>
                {% for temporada in temporadasSelect %}
                    <option value="{{ temporada.idTemporada }}" {% if temporada.idTemporada == idTemporada %}selected{% endif %}>
                        {{ temporada.numeroTemporada }}
                    </option>
                {% endfor %}
            </select><br>
            <label for="numeroEpisodio">Número de episodio:</label>
            <input type="number" id="numeroEpisodio" name="numeroEpisodio" value="{{numeroEpisodio}}" required><br>
            <label for="duracion">Duración:</label>
            <input type="number" id="duracion" name="duracion" value="{{duracion}}" required><br>
            <label for="idDirector">Director:</label>
            <select id="idDirector" name="idDirector" required>
                {% for director in directores %}
                    <option value="{{ director.id }}" {% if director.id == idDirector %}selected{% endif %}>
                        {{ director.nombre }}
                    </option>
                {% endfor %}
            </select><br>             

            <button type="submit">Actualizar Episodio</button>
    </div>
    </form>
</body>

</html>